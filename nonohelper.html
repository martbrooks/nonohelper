<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Nonogram Scratchpad</title>

<style>
  body {
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    max-width: 1000px;
    margin: 20px auto;
    padding: 0 16px 40px;
  }

  h1 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
    margin-bottom: 8px;
  }

  .controls label {
    font-size: 0.95rem;
  }

  .controls input[type="number"] {
    width: 70px;
    padding: 3px 6px;
  }

  button {
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background: #f4f4f4;
    cursor: pointer;
    font-size: 0.95rem;
  }

  button:hover {
    filter: brightness(1.05);
  }

  .mode-select {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    margin-bottom: 16px;
    font-size: 0.9rem;
  }

  .mode-select label {
    cursor: pointer;
  }

  /* Wrapper for zooming (no visible border/padding) */
  .board-wrapper {
    overflow: visible;
    max-height: none;
  }

  .board {
    display: flex;
    flex-direction: column;
    gap: 4px;
    user-select: none;
    transform-origin: top left;
  }

  .top-row,
  .bottom-row {
    display: flex;
    align-items: flex-start;
    gap: 4px;
  }

  .middle-row {
    display: flex;
    align-items: flex-start;
    gap: 4px;
  }

  .corner {
    width: 22px;
    height: 22px;
  }

  .number-row {
    display: grid;
  }

  .number-col {
    display: grid;
  }

  .number-row > div,
  .number-col > div {
    font-size: 12px;
    text-align: center;
    color: #444;
    line-height: 22px;
    width: 22px;
    height: 22px;
  }

  .grid {
    display: grid;
  }

  .cell {
    width: 22px;
    height: 22px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    background: #fff;
    font-size: 16px;
    line-height: 22px;
    text-align: center;
    cursor: pointer;
  }

  .cell.filled {
    background: #000;
    color: #000;
  }

  .cell.cross {
    background: #fff;
    color: #c00;
  }

  .selection-tooltip {
    position: fixed;
    padding: 2px 6px;
    font-size: 11px;
    background: rgba(0, 0, 0, 0.8);
    color: #fff;
    border-radius: 4px;
    pointer-events: none;
    z-index: 1000;
    display: none;
  }
</style>
</head>
<body>

<h1>Nonogram Scratchpad</h1>

<div class="controls">
  <label>
    Columns (width):
    <input type="number" id="colsInput" min="5" max="50" step="5" value="25">
  </label>
  <label>
    Rows (height):
    <input type="number" id="rowsInput" min="5" max="50" step="5" value="25">
  </label>
  <button id="buildGridBtn">Create / reset grid</button>
</div>

<div class="mode-select">
  <span>Selection mode:</span>
  <label><input type="radio" name="mode" value="line" checked> Straight line</label>
  <label><input type="radio" name="mode" value="rect"> Rectangle</label>
  <label><input type="radio" name="mode" value="free"> Freestyle</label>
</div>

<div class="board-wrapper" id="boardWrapper">
  <div class="board" id="boardRoot">

    <div class="top-row">
      <div class="corner"></div>
      <div id="topNums" class="number-row"></div>
      <div class="corner"></div>
    </div>

    <div class="middle-row">
      <div id="leftNums" class="number-col"></div>
      <div id="grid" class="grid"></div>
      <div id="rightNums" class="number-col"></div>
    </div>

    <div class="bottom-row">
      <div class="corner"></div>
      <div id="bottomNums" class="number-row"></div>
      <div class="corner"></div>
    </div>

  </div>
</div>

<script>
  const gridElement = document.getElementById("grid");
  const colsInput = document.getElementById("colsInput");
  const rowsInput = document.getElementById("rowsInput");
  const buildGridBtn = document.getElementById("buildGridBtn");

  const topNums = document.getElementById("topNums");
  const bottomNums = document.getElementById("bottomNums");
  const leftNums = document.getElementById("leftNums");
  const rightNums = document.getElementById("rightNums");

  const tooltip = document.createElement("div");
  tooltip.className = "selection-tooltip";
  document.body.appendChild(tooltip);

  const boardRoot = document.getElementById("boardRoot");
  const boardWrapper = document.getElementById("boardWrapper");

  let selectionMode = "line";
  let isMouseDown = false;
  let dragStartRow = null;
  let dragStartCol = null;
  let dragButton = null;
  let dragTargetState = null;

  let currentCols = 25;
  let currentRows = 25;

  let originalStates = null;

  let zoom = 1;

  document.querySelectorAll('input[name="mode"]').forEach(radio => {
    radio.addEventListener("change", () => {
      if (radio.checked) {
        selectionMode = radio.value;
        if (selectionMode === "free") hideTooltip();
      }
    });
  });

  function applyZoom() {
    boardRoot.style.transform = `scale(${zoom})`;
  }

  function showTooltip(text, x, y) {
    tooltip.textContent = text;
    tooltip.style.left = (x + 12) + "px";
    tooltip.style.top = (y + 12) + "px";
    tooltip.style.display = "block";
  }

  function hideTooltip() {
    tooltip.style.display = "none";
  }

  function normaliseDimension(value) {
    let n = parseInt(value, 10);
    if (isNaN(n)) n = 25;
    n = Math.min(50, Math.max(5, n));
    n = Math.round(n / 5) * 5;
    return n;
  }

  function buildGrid() {
    const COLS = normaliseDimension(colsInput.value);
    const ROWS = normaliseDimension(rowsInput.value);

    // write normalised values back into inputs
    colsInput.value = COLS;
    rowsInput.value = ROWS;

    currentCols = COLS;
    currentRows = ROWS;

    gridElement.style.gridTemplateColumns = `repeat(${COLS}, 22px)`;
    topNums.style.gridTemplateColumns = `repeat(${COLS}, 22px)`;
    bottomNums.style.gridTemplateColumns = `repeat(${COLS}, 22px)`;
    leftNums.style.gridTemplateRows = `repeat(${ROWS}, 22px)`;
    rightNums.style.gridTemplateRows = `repeat(${ROWS}, 22px)`;

    gridElement.innerHTML = "";
    topNums.innerHTML = "";
    bottomNums.innerHTML = "";
    leftNums.innerHTML = "";
    rightNums.innerHTML = "";

    for (let c = 1; c <= COLS; c++) {
      const t = document.createElement("div");
      t.textContent = c;
      topNums.appendChild(t);

      const b = document.createElement("div");
      b.textContent = c;
      bottomNums.appendChild(b);
    }

    for (let r = 1; r <= ROWS; r++) {
      const l = document.createElement("div");
      l.textContent = r;
      leftNums.appendChild(l);

      const rt = document.createElement("div");
      rt.textContent = r;
      rightNums.appendChild(rt);
    }

    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS; c++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.dataset.state = "empty";
        cell.dataset.row = r;
        cell.dataset.col = c;

        const topWidth = r === 0 ? 3 : r % 5 === 0 ? 2 : 1;
        const leftWidth = c === 0 ? 3 : c % 5 === 0 ? 2 : 1;
        const bottomWidth = r === ROWS - 1 ? 3 : (r + 1) % 5 === 0 ? 2 : 1;
        const rightWidth = c === COLS - 1 ? 3 : (c + 1) % 5 === 0 ? 2 : 1;

        cell.style.borderTopWidth = topWidth + "px";
        cell.style.borderLeftWidth = leftWidth + "px";
        cell.style.borderBottomWidth = bottomWidth + "px";
        cell.style.borderRightWidth = rightWidth + "px";

        cell.addEventListener("mousedown", handleMouseDown);
        cell.addEventListener("mouseenter", handleMouseEnter);

        gridElement.appendChild(cell);
      }
    }
  }

  function getState(cell) {
    return cell.dataset.state || "empty";
  }

  function setState(cell, state) {
    cell.dataset.state = state;
    cell.classList.remove("filled", "cross");
    cell.textContent = "";

    if (state === "filled") cell.classList.add("filled");
    if (state === "cross") {
      cell.classList.add("cross");
      cell.textContent = "Ã—";
    }
  }

  function nextStateLeftClick(current) {
    return current === "empty" ? "filled"
         : current === "filled" ? "cross"
         : "empty";
  }

  function nextStateRightClick(current) {
    return current === "empty" ? "cross"
         : current === "cross" ? "filled"
         : "empty";
  }

  function snapshotGrid() {
    originalStates = Array.from(gridElement.children, cell => cell.dataset.state);
  }

  function restoreGrid() {
    if (!originalStates) return;
    const cells = gridElement.children;
    for (let i = 0; i < originalStates.length; i++) {
      setState(cells[i], originalStates[i]);
    }
  }

  function handleMouseDown(event) {
    if (event.button !== 0 && event.button !== 2) return;

    event.preventDefault();
    hideTooltip();

    const cell = event.currentTarget;
    const row = +cell.dataset.row;
    const col = +cell.dataset.col;

    const current = getState(cell);
    const next = event.button === 0
      ? nextStateLeftClick(current)
      : nextStateRightClick(current);

    setState(cell, next);

    isMouseDown = true;
    dragButton = event.button;
    dragStartRow = row;
    dragStartCol = col;
    dragTargetState = next;

    if (selectionMode !== "free") {
      snapshotGrid();
      showTooltip("1x1", event.clientX, event.clientY);
    } else {
      originalStates = null;
    }
  }

  function handleMouseEnter(event) {
    if (!isMouseDown) return;

    const cell = event.currentTarget;
    const row = +cell.dataset.row;
    const col = +cell.dataset.col;

    if (selectionMode === "free") {
      const cur = getState(cell);
      const next = dragButton === 0
        ? nextStateLeftClick(cur)
        : nextStateRightClick(cur);
      setState(cell, next);
    } else if (selectionMode === "line") {
      restoreGrid();
      drawLine(row, col);
    } else if (selectionMode === "rect") {
      restoreGrid();
      drawRect(row, col);
    }
  }

  function drawLine(row, col) {
    const dr = row - dragStartRow;
    const dc = col - dragStartCol;

    if (Math.abs(dr) >= Math.abs(dc)) {
      const r1 = Math.min(dragStartRow, row);
      const r2 = Math.max(dragStartRow, row);
      for (let r = r1; r <= r2; r++) {
        const idx = r * currentCols + dragStartCol;
        setState(gridElement.children[idx], dragTargetState);
      }
    } else {
      const c1 = Math.min(dragStartCol, col);
      const c2 = Math.max(dragStartCol, col);
      for (let c = c1; c <= c2; c++) {
        const idx = dragStartRow * currentCols + c;
        setState(gridElement.children[idx], dragTargetState);
      }
    }
  }

  function drawRect(row, col) {
    const r1 = Math.min(dragStartRow, row);
    const r2 = Math.max(dragStartRow, row);
    const c1 = Math.min(dragStartCol, col);
    const c2 = Math.max(dragStartCol, col);

    for (let r = r1; r <= r2; r++) {
      for (let c = c1; c <= c2; c++) {
        const idx = r * currentCols + c;
        setState(gridElement.children[idx], dragTargetState);
      }
    }
  }

  gridElement.addEventListener("mousemove", (event) => {
    if (!isMouseDown || selectionMode === "free") {
      hideTooltip();
      return;
    }

    const cell = event.target.closest(".cell");
    if (!cell) return;

    const row = +cell.dataset.row;
    const col = +cell.dataset.col;

    let width = Math.abs(col - dragStartCol) + 1;
    let height = Math.abs(row - dragStartRow) + 1;

    if (selectionMode === "line") {
      const dr = row - dragStartRow;
      const dc = col - dragStartCol;
      if (Math.abs(dr) >= Math.abs(dc)) {
        width = 1;
        height = Math.abs(dr) + 1;
      } else {
        width = Math.abs(dc) + 1;
        height = 1;
      }
    }

    showTooltip(`${width}x${height}`, event.clientX, event.clientY);
  });

  document.addEventListener("mouseup", () => {
    isMouseDown = false;
    dragStartRow = null;
    dragStartCol = null;
    dragButton = null;
    dragTargetState = null;
    originalStates = null;
    hideTooltip();
  });

  gridElement.addEventListener("contextmenu", (e) => e.preventDefault());

  // Zoom: Ctrl (Windows/Linux) or Command (macOS) + wheel
  boardWrapper.addEventListener("wheel", (event) => {
    const isZoomGesture = event.ctrlKey || event.metaKey;
    if (!isZoomGesture) return;

    event.preventDefault();

    const delta = event.deltaY;
    const factor = delta < 0 ? 1.1 : 0.9;

    zoom *= factor;
    zoom = Math.min(3.0, Math.max(0.4, zoom));

    applyZoom();
  }, { passive: false });

  // Wire the button
  buildGridBtn.addEventListener("click", () => {
    hideTooltip();
    buildGrid();
  });

  // Initial grid and zoom
  buildGrid();
  applyZoom();
</script>

</body>
</html>
